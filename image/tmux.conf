# ── Isolab tmux.conf ───────────────────────────────────
# Session persistence + automatic logging for LLM agent work

# ── General ────────────────────────────────────────────
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -g history-limit 50000
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g set-clipboard on
set -sg escape-time 0

# ── Session logging ────────────────────────────────────
# Every pane logs to ~/logs/ automatically
set-hook -g after-new-window   "run-shell 'tmux pipe-pane -o \"cat >> #{HOME}/logs/#{session_name}-#{window_index}-#{pane_index}_$(date +%%Y-%%m-%%d).log\"'"
set-hook -g after-new-session  "run-shell 'tmux pipe-pane -o \"cat >> #{HOME}/logs/#{session_name}-#{window_index}-#{pane_index}_$(date +%%Y-%%m-%%d).log\"'"
set-hook -g after-split-window "run-shell 'tmux pipe-pane -o \"cat >> #{HOME}/logs/#{session_name}-#{window_index}-#{pane_index}_$(date +%%Y-%%m-%%d).log\"'"

# ── Status bar ─────────────────────────────────────────
set -g status on
set -g status-interval 5
set -g status-position bottom
set -g status-justify left

set -g status-style "bg=#0d1117,fg=#5a6a7a"
set -g message-style "bg=#0d1117,fg=#00ff88"

# Left: lab name
set -g status-left-length 30
set -g status-left "#[fg=#0d1117,bg=#00cc6a,bold] ⬡ #S #[fg=#00cc6a,bg=#0d1117] "

# Right: network mode + time
set -g status-right-length 60
set -g status-right "#[fg=#5a6a7a]#{pane_current_path} #[fg=#1e2a3a]│ #[fg=#ffaa00]#(cat ~/.isolab-net-mode 2>/dev/null || echo '?') #[fg=#1e2a3a]│ #[fg=#00ddff]%H:%M "

# Window tabs
setw -g window-status-format "#[fg=#5a6a7a] #I:#W "
setw -g window-status-current-format "#[fg=#00ff88,bold] #I:#W "
setw -g window-status-separator ""

# Pane borders
set -g pane-border-style "fg=#1e2a3a"
set -g pane-active-border-style "fg=#00cc6a"

# ── Keybindings ────────────────────────────────────────
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# Vim-style pane nav
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Reload
bind r source-file ~/.tmux.conf \; display "Config reloaded"

# Copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
